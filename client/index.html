<!DOCTYPE HTML>
<!--
    CruzHacks 2019
-->

<html>

<head>
    <title>ChemisTRY</title>
    <meta charset="utf-8" />

    <!--First = A-Frame. Second AR.JS Thrid = axios-->
    <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.5.0/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body style='margin : 0px; overflow: hidden;'>
    <a-scene embedded arjs>
        <a-marker preset="hiro" id="marker">
            <!-- <a-box color = "green" position = "0 0 0"></a-box> -->
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>


    <script>
        var i = 0;
        var n = 10;
        var atomId = 0;
        var moleculeId = 0;
        /* List of molecules on screen*/

        function Molecule(name, posX, posY, posZ) {
            this.name = name;
            this.posX = posX;
            this.posY = posY;
            this.posZ = posZ
            this.atomList = [];
        }

        var moleculeList = [];
        addMolecule('glucose');

        /* Glucose (C6H12O6) Properties */
        var GLUCOSE_POSITIONS = [
            /* Carbons (0-5) */
            "-2.5 0 -.5",
            "-1.5 0 .5",
            "-.5 0 -.5",
            ".5 0 .5",
            "1.5 0 -.5",
            "2.5 0 .5",
            /* Oxygens (6-11) */
            "-2.5 0 -1.5",
            "-1.5 0 1.5",
            "-.5 0 -1.5",
            ".5 0 1.5",
            "1.5 0 -1.5",
            "2.5 0 1.5",
            /* Hydrogens (12-23) */
            "-2.75 0 -1.75",
            "-2.25 0 -1.75",
            "-1.75 0 1.75",
            "-1.25 0 1.75",
            "-.75 0 -1.75",
            "-.25 0 -1.75",
            ".75 0 1.75",
            ".25 0 1.75",
            "1.75 0 -1.75",
            "1.25 0 -1.75",
            "2.75 0 1.75",
            "2.25 0 1.75",
        ];
        var GLUCOSE_SCALE = 1;

        /* Oxygen (O2) Properties */
        var OXYGEN_POSITIONS = [
            /* Oxygens (0-1) */
            "-.5 0 0",
            ".5 0 0"
        ];
        var OXYGEN_SCALE = 1;

        /* Carbon Dioxide (CO2) Properties */
        var CARBON_DIOXIDE_POSITIONS = [
            /* Carbon (0) */
            "0 0 0",
            /* Oxygens (1-2) */
            "-.5 0 .5",
            ".5 0 .5",
        ]
        var CARBON_DIOXIDE_SCALE = 1;

        /* WATER (H2O) Properties */
        var WATER_POSITIONS = [
            /* Oxygen (0) */
            "0 0 0",
            /* Hydrogens (1-2) */
            "-.5 0 .5",
            ".5 0 .5",
        ]
        var WATER_SCALE = 1;

        function addMolecule(molecule) {
            moleculeList.push(new Molecule(molecule, 0, 0, 0));
            switch (moleculeList[moleculeId].name) {
                case 'glucose':
                    addAtoms('carbon', 6);
                    addAtoms('oxygen', 6);
                    addAtoms('hydrogen', 12);
                    break;
                case 'water':
                    addAtom('oxygen', 1);
                    addAtom('hydrogen', 2);
                    break;
            }
            //Prob wrong place
            moleculeId++;

        }
        function addAtoms(atom, number) {
            for (var i = 0; i < number; i++) {
                addAtom(atom);
            }
        }
        function addAtom(atom) {
            moleculeList[moleculeId].atomList.push(atomId);
            $("#marker").append(
                '<a-sphere id =\"' + "id" + (atomId++) + '\"color = ' + getColorOfAtom(atom) + ' position = "0 0 0" radius = \"' + getRadiusOfAtom(atom) + '\"></a-box>'
            );
        }
        function getColorOfAtom(atom) {
            switch (atom) {
                case 'carbon': return "\"black\"";
                case 'oxygen': return "\"red\"";
                case 'hydrogen': return "\"white\"";
            }
        }
        function getRadiusOfAtom(atom) {
            switch (atom) {
                case 'carbon': return .5;
                case 'oxygen': return .25;
                case 'hydrogen': return .1;
            }
        }

        function append() {
            // console.log("Appending");
            // var positions = [];
            // for (let i = 0; i < n; i++) {
            //     positions.push(i * .2 + " " + i * 0 + " " + i * .2);
            // }
            // while (i < n) {

            // }
        };

        function calcPosChange(pos, targetPos) {

            if (Math.abs(pos - targetPos) > .01) {
                pos -= (pos - targetPos) * 0.1;

            }
            return pos;
        }

        setInterval(function () {
            //If not at target position animate
            var moleculePosition = [moleculeList[0].posX, moleculeList[0].posY, moleculeList[0].posZ];

            for (let i = 0; i < atomId; i++) {
                var element = document.getElementById("id" + i);
                if (element != null) {
                    var position = (document.getElementById("id" + i).getAttribute("position"));
                    //Need to have a way to get the moleculePosition for the function call.
                    var targetPosition = calcTargetPosition(moleculePosition, moleculeList[0], i);

                    var posX = calcPosChange(position.x, targetPosition[0]);
                    var posY = calcPosChange(position.y, targetPosition[1]);
                    var posZ = calcPosChange(position.z, targetPosition[2]);


                    document.getElementById("id" + i).setAttribute("position", posX + " " + posY + " " + posZ);

                }
                else {
                    console.log(i + " does not exist");
                }
            }
        }, 1000);

        function calcTargetPosition(moleculePosition, molecule, elementNumber) {
            //Based on index see where you need to be. 
            var targetPosition = [];
            var offSet = GLUCOSE_POSITIONS[elementNumber].split(" ");
            var offSetX = parseFloat(offSet[0]);
            var offSetZ = parseFloat(offSet[2]);

            //TODO: Generalize this for different molecules.
            targetPosition[0] = moleculePosition[0] + offSetX;
            targetPosition[1] = moleculePosition[1];
            targetPosition[2] = moleculePosition[2] + offSetZ;

            return targetPosition;
        }

        //Work on logic that would assign elements to others by groups. Based on IDs
        function reassignElements(moleculeIndex) {
            //I have global variable that has all the molecules on the screen
            //Pass in molecule that would be broken down and append it to the global variable.

            //Given the molecule index go to that molecule and see the elements that it can be broken into.
            //Prob will hardcode that an glucose can do specfic things. 

            //Add 6O2 from somewhere could add it to the the moleculeList

            brokenMolecule = moleculeList[moleculeNumber];

            switch (brokenMolecule.name) {
                case ('glucose'):
                    moleculeList.push('water', 0, 0, 0);
                    moleculeId++;
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[6]);
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[12]);
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[13]);

                    moleculeList.push('water', 0, 0, 0);
                    moleculeId++;
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[7]);
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[14]);
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[15]);

                    moleculeList.push('water', 0, 0, 0);
                    moleculeId++;
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[8]);
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[16]);
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[17]);

                    moleculeList.push('water', 0, 0, 0);
                    moleculeId++;
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[9]);
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[18]);
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[19]);

                    moleculeList.push('water', 0, 0, 0);
                    moleculeId++;
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[10]);
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[20]);
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[21]);

                    moleculeList.push('water', 0, 0, 0);
                    moleculeId++;
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[11]);
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[22]);
                    moleculeList[moleculeId].atomList.push(brokenMolecule.atomList[23]);


                    moleculeList.push('carbon_dioxide', 0, 0, 0);
                    moleculeId++;
                    moleculeList[moleculeId].atomList.push(0);
                    //Add O2 from the new thing.
                    //moleculeList[moleculeId].atomList.push(i);
                    //moleculeList[moleculeId].atomList.push(i);

                    moleculeList.push('carbon_dioxide', 0, 0, 0);
                    moleculeId++;
                    moleculeList[moleculeId].atomList.push(1);
                    //Add O2 from the new thing.
                    //moleculeList[moleculeId].atomList.push(i);
                    //moleculeList[moleculeId].atomList.push(i);

                    moleculeList.push('carbon_dioxide', 0, 0, 0);
                    moleculeId++;
                    moleculeList[moleculeId].atomList.push(2);
                    //Add O2 from the new thing.
                    //moleculeList[moleculeId].atomList.push(i);
                    //moleculeList[moleculeId].atomList.push(i);

                    moleculeList.push('carbon_dioxide', 0, 0, 0);
                    moleculeId++;
                    moleculeList[moleculeId].atomList.push(3);
                    //Add O2 from the new thing.
                    //moleculeList[moleculeId].atomList.push(i);
                    //moleculeList[moleculeId].atomList.push(i);

                    moleculeList.push('carbon_dioxide', 0, 0, 0);
                    moleculeId++;
                    moleculeList[moleculeId].atomList.push(4);
                    //Add O2 from the new thing.
                    //moleculeList[moleculeId].atomList.push(i);
                    //moleculeList[moleculeId].atomList.push(i);

                    moleculeList.push('carbon_dioxide', 0, 0, 0);
                    moleculeId++;
                    moleculeList[moleculeId].atomList.push(5);
                    //Add O2 from the new thing.
                    //moleculeList[moleculeId].atomList.push(i);
                    //moleculeList[moleculeId].atomList.push(i);

            break;
                case ('water'):
            break;
                case ('plutonium'):
            break;
        }
        moleculeList.splice(moleculeNumber, 1);
        }

        // append();
        // setInterval(moveToPosition, 1000);

        // axios.get('/api/data/').then(function (symbol) {
        //     //Build Function gets called or I can have it in here.
        //     console.log(symbol);
        //     // buildMolecule(symbol);
        // }).catch(function (error) {
        //     comsole.log(error);
        // });

    </script>
</body>

</html>